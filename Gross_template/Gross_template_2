<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pathology Gross Questionnaire</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 40px; }
        .card { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .node { margin-left: 20px; border-left: 2px solid #e9ecef; padding-left: 15px; margin-bottom: 10px; }
        .label-text { font-weight: 600; color: #495057; display: block; margin-bottom: 5px; text-transform: capitalize; }
        select, input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ced4da; border-radius: 4px; }
        h2 { color: #0d6efd; border-bottom: 2px solid #0d6efd; padding-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Gross Examination Entry</h2>
    <div id="form-build">Loading questionnaire...</div>
    <button onclick="saveData()" style="margin-top:20px; padding: 10px 20px; background: #198754; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Export Selection
    </button>
</div>

<script>
    // 1. FETCH THE EXTERNAL JSON FILE
    async function loadQuestionnaire() {
        try {
            const response = await fetch('gross_question_lists.json');
            if (!response.ok) throw new Error("Failed to load JSON file.");
            const data = await response.json();
            
            const container = document.getElementById('form-build');
            container.innerHTML = ''; // Clear loading text
            generateUI(data, container);
        } catch (error) {
            document.getElementById('form-build').innerHTML = `<p style="color:red">Error: ${error.message}<br>Make sure you are using 'Live Server'</p>`;
        }
    }

    // 2. RECURSIVE UI GENERATOR
    function generateUI(data, parent) {
        for (const key in data) {
            const value = data[key];
            const wrapper = document.createElement('div');
            wrapper.className = 'node';

            // Create Label
            const label = document.createElement('label');
            label.className = 'label-text';
            label.innerText = key.replace(/_/g, ' ');
            wrapper.appendChild(label);

            if (Array.isArray(value)) {
                // If it's a simple list of options
                if (typeof value[0] !== 'object') {
                    const select = document.createElement('select');
                    select.name = key;
                    value.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt;
                        option.text = opt === null ? "None/Default" : opt;
                        select.appendChild(option);
                    });
                    wrapper.appendChild(select);
                } else {
                    // If it's an array of nested objects (like organ_set)
                    value.forEach(subObj => {
                        if (typeof subObj === 'string') {
                            const input = document.createElement('input');
                            input.placeholder = `Details for ${subObj}...`;
                            wrapper.appendChild(input);
                        } else {
                            generateUI(subObj, wrapper);
                        }
                    });
                }
            } else if (typeof value === 'object' && value !== null) {
                // Nested Object (like tumor_attribute)
                generateUI(value, wrapper);
            }

            parent.appendChild(wrapper);
        }
    }

    function saveData() {
        alert("Check the browser console (F12) to see your selected data!");
        // Logic to gather form data would go here
    }

    // Run on load
    loadQuestionnaire();
</script>

</body>
</html>